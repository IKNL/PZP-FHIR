map "http://hl7.org/fhir/StructureMap/VisionPrescription4to3" = "R4 to R3 Conversion for VisionPrescription"

uses "http://hl7.org/fhir/StructureDefinition/VisionPrescription" alias VisionPrescription as source
uses "http://hl7.org/fhir/3.0/StructureDefinition/VisionPrescription" alias VisionPrescriptionR3 as target

imports "http://hl7.org/fhir/StructureMap/*4to3"

group VisionPrescription(source src : VisionPrescription, target tgt : VisionPrescriptionR3) extends DomainResource <<type+>> {
  src.identifier as vs -> tgt.identifier as vt then Identifier(vs, vt);
  src.status as vs -> tgt.status as vt then code(vs, vt);
  src.patient as vs -> tgt.patient as vt then string(vs, vt);
  src.encounter as vs -> tgt.encounter as vt then Reference(vs, vt);
  src.dateWritten as vs -> tgt.dateWritten as vt then string(vs, vt);
  src.prescriber as vs -> tgt.prescriber as vt then string(vs, vt);
  src.extension as e where url = 'http://hl7.org/fhir/3.0/StructureDefinition/extension-VisionPrescription.reason' then {
    e.value -> tgt.reason;
  };
  src.lensSpecification as s -> tgt.dispense as t then dispense(s, t);
}

group dispense(source src, target tgt) extends BackboneElement {
  src.product as vs -> tgt.product as vt then string(vs, vt);
  src.eye as vs -> tgt.eye as vt then string(vs, vt);
  src.sphere as vs -> tgt.sphere as vt then string(vs, vt);
  src.cylinder as vs -> tgt.cylinder as vt then string(vs, vt);
  src.axis as vs -> tgt.axis as vt then string(vs, vt);
  src.prism as s then {
    s.amount -> tgt.prism;
    s.base -> tgt.base;
  };
  src.add as vs -> tgt.add as vt then string(vs, vt);
  src.power as vs -> tgt.power as vt then string(vs, vt);
  src.backCurve as vs -> tgt.backCurve as vt then string(vs, vt);
  src.diameter as vs -> tgt.diameter as vt then string(vs, vt);
  src.duration as vs -> tgt.duration as vt then string(vs, vt);
  src.color as vs -> tgt.color as vt then string(vs, vt);
  src.brand as vs -> tgt.brand as vt then string(vs, vt);
  src.note as vs -> tgt.note as vt then Annotation(vs, vt);
}

