map "http://hl7.org/fhir/StructureMap/Dosage4to3" = "R4 to R3 Conversion for Dosage"

uses "http://hl7.org/fhir/StructureDefinition/Dosage" alias Dosage as source
uses "http://hl7.org/fhir/3.0/StructureDefinition/Dosage" alias DosageR3 as target

imports "http://hl7.org/fhir/StructureMap/*4to3"

group Dosage(source src : Dosage, target tgt : DosageR3) extends BackboneElement <<type+>> {
  src.sequence as vs -> tgt.sequence as vt then string(vs, vt);
  src.text as vs -> tgt.text as vt then Narrative(vs, vt);
  src.additionalInstruction as vs -> tgt.additionalInstruction as vt then string(vs, vt);
  src.patientInstruction as vs -> tgt.patientInstruction as vt then string(vs, vt);
  src.timing as vs -> tgt.timing as vt then string(vs, vt);
  src.asNeeded : boolean as vs -> tgt.asNeeded = create('boolean') as vt then boolean(vs, vt);
  src.asNeeded : CodeableConcept as vs -> tgt.asNeeded = create('CodeableConcept') as vt then CodeableConcept(vs, vt);
  src.site as vs -> tgt.site as vt then string(vs, vt);
  src.route as vs -> tgt.route as vt then string(vs, vt);
  src.method as vs -> tgt.method as vt then CodeableConcept(vs, vt);
  src.doseAndRate as vs0 then doseAndRate(vs0, tgt);
  src.maxDosePerPeriod as vs -> tgt.maxDosePerPeriod as vt then string(vs, vt);
  src.maxDosePerAdministration as vs -> tgt.maxDosePerAdministration as vt then string(vs, vt);
  src.maxDosePerLifetime as vs -> tgt.maxDosePerLifetime as vt then string(vs, vt);
}

group doseAndRate(source src, target tgt) {
  src.dose : Range as vs -> tgt.dose = create('Range') as vt then Range(vs, vt);
  src.dose : Quantity as vs -> tgt.dose = create('Quantity') as vt then Quantity(vs, vt);
  src.rate : Ratio as vs -> tgt.rate = create('Ratio') as vt then Ratio(vs, vt);
  src.rate : Range as vs -> tgt.rate = create('Range') as vt then Range(vs, vt);
  src.rate : Quantity as vs -> tgt.rate = create('Quantity') as vt then Quantity(vs, vt);
}

